{"version":3,"file":"login-f17749f2.js","sources":["../../../../pages/user/login.vue"],"sourcesContent":["<script setup>\r\nimport { useAuthStore } from \"@/stores/authStore\";\r\nimport { useLoaderStore } from \"~~/stores/loader\";\r\nimport { useFavStore } from \"~~/stores/favourite\";\r\n\r\nimport { useTrashStore } from \"~~/stores/trash\";\r\nimport { useToast } from \"vue-toastification\";\r\nconst $toast = useToast();\r\n\r\nconst favStore = useFavStore();\r\nconst trash = useTrashStore();\r\n\r\nconst loaderStore = useLoaderStore();\r\ndefinePageMeta({\r\n  layout: \"default\",\r\n  // middleware: [\"redirect\"],\r\n});\r\nconst user = ref(\"\");\r\nconst password = ref(\"\");\r\nconst err_valid = ref(\"user_exist\");\r\nconst pendings = ref(false);\r\nconst isValid = ref(true);\r\nconst authStore = useAuthStore();\r\nconst router = useRouter();\r\n\r\nasync function signUp() {\r\n  try {\r\n    // simple data validation\r\n    if (!user.value || !password.value) {\r\n      // isValid.value = false;\r\n      user.value = \"\";\r\n      password.value = \"\";\r\n      return;\r\n      // throw new Error(\"Please fill all fields\");\r\n    }\r\n    pendings.value = true;\r\n\r\n    const { data, pending, status, error } = await useFetch(\r\n      \"http://duypbaha.com.tm/api/v1/client/user-register\",\r\n      {\r\n        method: \"POST\",\r\n        body: {\r\n          username: user.value,\r\n          password: password.value,\r\n        },\r\n      }\r\n    );\r\n    console.log(error);\r\n    if (error.value?.fatal == false) {\r\n      pendings.value = false;\r\n      err_valid.value = \"user_exist\";\r\n      isValid.value = false;\r\n\r\n      return;\r\n      // return $toast.error(`username exist`);\r\n    }\r\n    if (data.value?.status) {\r\n      await login();\r\n    }\r\n    if (pending) {\r\n      pendings.value = true;\r\n    }\r\n    pendings.value = false;\r\n  } catch (error) {\r\n    throw error;\r\n  }\r\n}\r\nasync function login() {\r\n  try {\r\n    // simple data validation\r\n    if (!user.value || !password.value) {\r\n      // isValid.value = false;\r\n      user.value = \"\";\r\n      password.value = \"\";\r\n      return;\r\n    }\r\n\r\n    pendings.value = true;\r\n    const { data, pending, status, error } = await useFetch(\r\n      \"http://duypbaha.com.tm/api/v1/client/user/login\",\r\n      {\r\n        method: \"POST\",\r\n        body: {\r\n          username: user.value,\r\n          password: password.value,\r\n        },\r\n      }\r\n    );\r\n    authStore.userToken = data.value?.auth;\r\n    if (!data.value.status) {\r\n      isValid.value = false;\r\n\r\n      err_valid.value = \"not_correct_data\";\r\n      // $toast.error(data.value.message);\r\n    }\r\n    pendings.value = false;\r\n  } catch (err) {\r\n    console.log(err);\r\n  }\r\n\r\n  try {\r\n    if (authStore.userToken?.uuid) {\r\n      var {\r\n        data: wish_user,\r\n        error: wishErr,\r\n        status,\r\n      } = await useMyFetch(\r\n        `/api/v1/client/wish-list?lang=tm&user_id=${authStore.userToken?.uuid}`\r\n      );\r\n    }\r\n    console.log(wish_user.value.status, \"wish_user.value\");\r\n    if (wish_user.value.status && wish_user.value?.data?.length) {\r\n      favStore.wish_items = [];\r\n      console.log(\"[][]\");\r\n      wish_user.value.data?.filter((e) => {\r\n        e.images = e.img_path;\r\n        favStore.setLocalStorage(e);\r\n      });\r\n\r\n      // favStore.wish_items = wish_user.value.data;\r\n    } else if (!wish_user.value?.data?.length) {\r\n      favStore.wish_items = [];\r\n    }\r\n  } catch (err) {\r\n    console.log(err);\r\n  }\r\n\r\n  try {\r\n    if (authStore.userToken?.uuid) {\r\n      var { data: user_trash } = await useMyFetch(\r\n        `/api/v1/client/trash?user_id=${authStore.userToken?.uuid}&lang=tm`\r\n      );\r\n    }\r\n    if (user_trash.value?.status && user_trash.value?.data?.length) {\r\n      user_trash.value?.data?.filter((e) => {\r\n        e.images = e.img_path;\r\n      });\r\n\r\n      trash.trash_items.products = user_trash.value?.data;\r\n    }\r\n    router.push(\"/\");\r\n  } catch (e) {\r\n    console.log(e);\r\n  }\r\n}\r\nconst logout = () => {\r\n  authStore.userToken = \"\";\r\n  router.push(\"/\");\r\n};\r\n</script>\r\n\r\n<template>\r\n  <div\r\n    class=\"flex justify-center pt-34 md:pt-40 h-[110vh] absolute top-0 bg-slate-300 z-40 w-full\"\r\n  >\r\n    <div class=\"w-full max-w-md\">\r\n      <div\r\n        class=\"text-3xl font-bold text-center mb-6 flex w-full justify-between\"\r\n      ></div>\r\n      <form class=\"bg-c-gray shadow-lg rounded px-8 pt-6 pb-8 mb-4\">\r\n        <img\r\n          class=\"mx-auto md:cursor-pointer cursor-auto\"\r\n          @click=\"router.push(localePath('/'))\"\r\n          src=\"~/assets/images/logo.png\"\r\n          alt=\"\"\r\n        />\r\n\r\n        <div class=\"mb-4\">\r\n          <BaseInput\r\n            :label=\"$t('username')\"\r\n            id=\"username\"\r\n            name=\"username\"\r\n            type=\"text\"\r\n            placeholder=\"aman@example.com\"\r\n            v-model=\"user\"\r\n          />\r\n        </div>\r\n        <div class=\"mb-6\">\r\n          <BaseInput\r\n            :label=\"$t('password')\"\r\n            id=\"password\"\r\n            name=\"password\"\r\n            type=\"password\"\r\n            placeholder=\"···········\"\r\n            v-model=\"password\"\r\n          />\r\n        </div>\r\n        <p class=\"text-xs text-gray-400 mb-3\">{{ $t(\"alert_login\") }}</p>\r\n        <p class=\"text-red-500 text-sm inter font-bold mb-4\" v-if=\"!isValid\">\r\n          {{ $t(err_valid) }}\r\n        </p>\r\n        <div class=\"flex w-full gap-5 items-center justify-between\">\r\n          <button\r\n            class=\"bg-blue-700 rounded-2xl w-1/2 text-white font-bold py-2 px-4 focus:outline-none focus:shadow-outline\"\r\n            type=\"button\"\r\n            @click=\"login\"\r\n          >\r\n            {{ $t(\"signin\") }}\r\n          </button>\r\n          <p class=\"p-2 rounded-md text-white font-bold\" v-if=\"pendings\">\r\n            <img src=\"@/assets/images/loader.gif\" alt=\"\" />\r\n          </p>\r\n          <button\r\n            class=\"text-blue-700 border-blue-700 border-2 rounded-2xl w-1/2 font-bold py-2 px-4 focus:outline-none focus:shadow-outline\"\r\n            type=\"button\"\r\n            @click=\"signUp\"\r\n          >\r\n            {{ $t(\"signup\") }}\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  </div>\r\n</template>\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOe,aAAW;AAET,gBAAc;AACjB,kBAAgB;AAEV,mBAAiB;AAKrC,UAAM,OAAO,IAAI,EAAE;AACnB,UAAM,WAAW,IAAI,EAAE;AACvB,UAAM,YAAY,IAAI,YAAY;AAClC,UAAM,WAAW,IAAI,KAAK;AAC1B,UAAM,UAAU,IAAI,IAAI;AACN,iBAAe;AAClB,cAAY;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}